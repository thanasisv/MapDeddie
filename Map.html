<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KML Search</title>
    <!-- Συμπερίληψη των JavaScript αρχείων του Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key= AIzaSyAIpW0xPz54Mq3F8cpmSox7QbTD6vGRj90&callback=initMap" async defer></script>
</head>

<body>
    <!-- Περιοχή όπου θα εμφανιστεί ο χάρτης -->
    <div id="map" style="height: 400px;"></div>

    <!-- Πεδίο κειμένου αναζήτησης -->
    <input type="text" id="searchInput" placeholder="Αναζήτηση..." />

    <!-- Κουμπί Αναζήτησης -->
    <button onclick="searchKml()">Αναζήτηση</button>

    <!-- Περιοχή για εμφάνιση αποτελεσμάτων -->
    <div id="searchResults"></div>

    <!-- Συμπερίληψη του JavaScript κώδικα -->
    <script>
        var map;
        var markers = [];
        var infowindow;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 0, lng: 0 },
                zoom: 2
            });

            infowindow = new google.maps.InfoWindow();

            // Φόρτωση του KML αρχείου
            loadKmlFromUrl('https://drive.google.com/file/d/1FlkQiVsFSP6bCRWxqJ578eDymuSRKR7p/view?usp=drivesdk');
        }

        function loadKmlFromUrl(url) {
            var kmlLayer = new google.maps.KmlLayer({
                map: map,
                url: url,
                suppressInfoWindows: true,
                preserveViewport: false
            });

            // Προσθήκη ακροατή για το γεγονός 'click' στα στοιχεία του KML
            kmlLayer.addListener('click', function (event) {
                var content = event.featureData.description;
                infowindow.setContent(content);
                infowindow.setPosition(event.latLng);
                infowindow.setOptions({ pixelOffset: new google.maps.Size(0, -30) });
                infowindow.open(map);
            });
        }

        function searchKml() {
            var keyword = document.getElementById('searchInput').value;

            // Καθαρίζουμε τον χάρτη από τα προηγούμενα markers
            clearMarkers();

            // Αναζήτηση εντός των στοιχείων του KML
            var results = [];
            map.data.forEach(function (feature) {
                var description = feature.getProperty('description');
                var name = feature.getProperty('name');

                if (description && description.includes(keyword)) {
                    results.push({ name: name, description: description });
                    createMarker(feature.getGeometry().get(), name, description);
                } else if (name && name.includes(keyword)) {
                    results.push({ name: name, description: description });
                    createMarker(feature.getGeometry().get(), name, description);
                }
            });

            // Εμφάνιση αποτελεσμάτων
            displayResults(results);
        }

        function createMarker(coordinates, name, description) {
            var marker = new google.maps.Marker({
                position: coordinates,
                map: map,
                title: name
            });

            marker.addListener('click', function () {
                infowindow.setContent(description);
                infowindow.open(map, marker);
            });

            markers.push(marker);
        }

        function clearMarkers() {
            // Καθαρίζουμε τον χάρτη από τα προηγούμενα markers
            markers.forEach(function (marker) {
                marker.setMap(null);
            });

            markers = [];
        }

        function displayResults(results) {
            var resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = ''; // Καθαρίζουμε τα προηγούμενα αποτελέσματα

            if (results.length === 0) {
                resultsContainer.innerHTML = 'Δεν βρέθηκαν αποτελέσματα.';
            } else {
                results.forEach(function (result) {
                    var resultItem = document.createElement('div');
                    resultItem.innerHTML = '<strong>' + result.name + '</strong>: ' + result.description;
                    resultsContainer.appendChild(resultItem);
                });
            }
        }
    </script>
</body>

</html>
