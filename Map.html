<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Map Page</title>
    <!-- Συμπερίληψη των JavaScript αρχείων του Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key= AIzaSyAIpW0xPz54Mq3F8cpmSox7QbTD6vGRj90&callback=initMap" async defer></script>
</head>

<body>
    <!-- Περιοχή όπου θα εμφανιστεί ο χάρτης -->
    <div id="map" style="height: 400px;"></div>

    <!-- Κουτί αναζήτησης αρχείου KML -->
    <input type="file" accept=".kml" onchange="handleFile(this.files)" />

    <!-- Πεδίο κειμένου αναζήτησης -->
    <input type="text" placeholder="Αναζήτηση..." oninput="searchKmlLayer(this.value)" />

    <!-- Συμπερίληψη του JavaScript κώδικα -->
    <script>
        var map;
        var kmlLayer;
        var searchData;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -34.397, lng: 150.644 },
                zoom: 8
            });

            // Δεν φορτώνουμε αυτόματα το KML αρχείο. Η φόρτωση γίνεται όταν ο χρήστης επιλέξει ένα αρχείο.
        }

        function handleFile(files) {
            var file = files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var kmlData = e.target.result;
                    searchData = parseKmlData(kmlData);
                };
                reader.readAsText(file);
            }
        }

        function parseKmlData(kmlData) {
            // Εδώ πρέπει να προσαρμοστεί ο κώδικας για το parsing του KML και την εξαγωγή των δεδομένων αναζήτησης
            // Επιστρέφουμε τα δεδομένα που χρειαζόμαστε για την αναζήτηση
        }

        function searchKmlLayer(keyword) {
            if (!searchData) return;

            // Εδώ πρέπει να προσαρμοστεί ο κώδικας για την αναζήτηση μέσα στα δεδομένα του KML
            var results = searchData.filter(function (item) {
                return item.name.includes(keyword) || item.description.includes(keyword);
            });

            // Καθαρίζουμε τον χάρτη από προηγούμενα markers
            clearMap();

            // Δημιουργούμε νέα markers για τα αποτελέσματα
            results.forEach(function (result) {
                createMarker(result);
            });
        }

        function createMarker(place) {
            var loc = place.Point.coordinates.split(",");
            var marker = new google.maps.Marker({
                map: map,
                position: new google.maps.LatLng(loc[1], loc[0])
            });
            google.maps.event.addListener(marker, 'click', function () {
                infowindow.setContent(place.name);
                infowindow.open(map, marker);
            });
        }

        function clearMap() {
            // Καθαρίζουμε τον χάρτη από τα markers
            // Εδώ πρέπει να προσαρμοστεί ο κώδικας για τον καθαρισμό του χάρτη
        }
    </script>
</body>

</html>
